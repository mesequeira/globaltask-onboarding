services:
  users.webapi:
    image: ${DOCKER_REGISTRY-}userswebapi
    ports:
      - "5000:8080"
      - "5001:8081"
    build:
      context: .
      dockerfile: Users.WebApi/Dockerfile
    environment:
        - ConnectionStrings__ConnectionString=Server=${DB_SERVER_HOST},1433;Database=${DB_DATABASE};TrustServerCertificate=True;User Id=${DB_USER};Password=${DB_PASSWORD}
        - MESSAGE_BROKER_HOST=${MESSAGE_BROKER_HOST}
        - MESSAGE_BROKER_USERNAME=${MESSAGE_BROKER_USERNAME} 
        - MESSAGE_BROKER_PASSWORD=${MESSAGE_BROKER_PASSWORD} 
    depends_on: 
        - users.database
    networks:
        - users-network

  users.database:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: sqlserver
    ports:
        - "1433:1433" 
    environment:
       - ACCEPT_EULA=YES
       - MSSQL_SA_PASSWORD=${DB_PASSWORD}
    volumes:
      - sqlserver-data:/var/opt/mssql 
    networks:
        - users-network

volumes:
  sqlserver-data: 
    driver: local

networks:
  users-network:
     external: true

